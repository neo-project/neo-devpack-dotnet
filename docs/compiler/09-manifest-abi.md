# Manifest and ABI Generation

The contract manifest (`<BaseName>.manifest.json`) is a crucial file generated by the Neo C# Compiler (`nccs`). It acts as a standardized description of the smart contract, providing essential metadata and defining its Application Binary Interface (ABI).

## Purpose of the Manifest

The manifest serves several key purposes:

*   **Interoperability:** It allows wallets, explorers, dApps, and other smart contracts to understand how to interact with the compiled contract without needing its source code.
*   **Deployment:** It contains information required during the deployment process, such as required permissions.
*   **Metadata:** It provides human-readable information like the contract's name and supported standards.
*   **Security:** Declares permissions and trusts, enabling nodes and users to enforce security policies.

## Manifest Structure

A typical manifest JSON file includes the following sections:

*   **`name`**: The human-readable name of the contract. Often derived from the C# class name or a `[DisplayName]` attribute.
*   **`groups`**: (Used for managing update permissions across multiple contracts, typically empty for single contracts).
*   **`features`**: Describes optional features enabled for the contract (e.g., storage, payable). The compiler usually determines these automatically based on framework usage.
*   **`supportedstandards`**: An array of NEP standard identifiers (e.g., `"NEP-17"`, `"NEP-11"`) that the contract claims to implement. Derived from `[SupportedStandards]` attributes.
*   **`abi`**: Defines the contract's interface.
    *   **`methods`**: An array describing the publicly callable methods.
        *   `name`: The name of the method (as defined in the C# code).
        *   `offset`: The starting instruction offset of the method within the compiled `.nef` script.
        *   `parameters`: An array describing the method's parameters (`name`, `type`).
        *   `returntype`: The type of the value returned by the method.
        *   `safe`: A boolean indicating if the method is read-only (a "safe" method, typically marked with `[Safe]`).
    *   **`events`**: An array describing the events the contract might emit.
        *   `name`: The name of the event (from the C# `delegate` or `event` definition).
        *   `parameters`: An array describing the event's parameters (`name`, `type`).
*   **`permissions`**: An array defining the permissions the contract requests.
    *   `contract`: The contract hash (or `*` for wildcard) the permission applies to.
    *   `methods`: The methods (or `*` for wildcard) the contract needs to call on the target `contract`.
    Derived from `[ContractPermission]` attributes.
*   **`trusts`**: An array declaring which contract hashes or public keys are trusted by this contract (e.g., allowed to call sensitive methods). Use `*` for wildcard trust (generally discouraged). Derived from `[ContractTrust]` attributes.
*   **`extra`**: A flexible field for arbitrary JSON metadata. Can be populated using attributes inheriting from `[ManifestExtraAttribute]` (like `[Author]`, `[Email]`, `[Description]`, `[Version]`). The compiler also adds optimization information here if optimizations were enabled.

## ABI (Application Binary Interface)

The `abi` section within the manifest is the contract's public interface definition. It details:

*   **Methods:** Which functions can be invoked, what parameters they expect (name and type), and what type they return.
*   **Events:** Which events the contract can emit and the structure of their payloads.

Type information in the ABI uses `ContractParameterType` enums (e.g., `Integer`, `String`, `Hash160`, `Array`, `Boolean`, `Void`, `PublicKey`, `Signature`, `ByteArray`, `Map`, `Any`). The compiler automatically maps C# types to these ABI types.

## How Information is Gathered

The compiler gathers information for the manifest during the compilation process:

*   **Attributes:** It inspects C# attributes applied to the contract class, methods, events, and parameters:
    *   `[DisplayName("MyContract")]` -> `name`
    *   `[SupportedStandards("NEP-17")]` -> `supportedstandards`
    *   `[Safe]` on a method -> `abi.methods[].safe = true`
    *   `[ContractPermission("*", "*")]` -> `permissions`
    *   `[ContractTrust("0x...")]` -> `trusts`
    *   `[Author("...")]`, `[Email("...")]`, etc. -> `extra`
*   **Code Analysis:**
    *   Public methods become ABI methods.
    *   Public events (`delegate` + `event`) become ABI events.
    *   Method/event parameter names and types are extracted.
    *   Method return types are determined.
    *   The starting offset of each public method in the bytecode is calculated.
*   **Default Conventions:** If attributes are missing, the compiler uses defaults (e.g., class name for contract name).

Understanding the manifest and ABI is essential for anyone interacting with a deployed Neo smart contract.
